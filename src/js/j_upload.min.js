!function(e,i,t){e.fn.j_upload=function(l){return this.each(function(){var a,n,r,s,_,o,f,m,u,v,p,d,c,g,h=(a="#{id}_preview",n="<a href='' target='{input_name}' file_id='{file_id}' class='{custom_class} {default_class}'>{rm_label}</a>",r=!0,s=function(i,t){var l=e("<{tag}></{tag}>".pyFormat({tag:t.message_element}));l.attr("id",i.attr("id")+"_message"),l.attr("class","j_message_container"),i.after(l)},_=function(e,i,t){var l=f(e);return l.tag=t.preview_element_item,l.href=n.pyFormat({file_id:"",default_class:"j_remove",input_name:i,custom_class:t.remove_link_style,rm_label:t.remove_link_label}),'<{tag} class="j_preview_container_item" title="{file_name}">{file_short_name} ({file_extension}) ({file_size} MB) {href}</{tag}}>'.pyFormat(l)},o=function(e,i,t,l){var a=f(e),r=v(a,i);return a.exist_class=r?"j_file_exist":"",a.tag=l.preview_element_item,a.file_id=t,a.href=n.pyFormat({default_class:"j_remove_multiple",input_name:i,file_id:t,custom_class:l.remove_link_style,rm_label:l.remove_link_label}),'<{tag} class="j_preview_container_item {exist_class}" title="{file_name}" id="{file_id}">{file_short_name} ({file_extension}) ({file_size} MB) {href}</{tag}>'.pyFormat(a)},f=function(e){var i=e.name.lastIndexOf("."),t=m(e.size/1e3/1e3),l=e.name.substring(0,i);return{file_name:l,file_size:t,file_extension:e.name.substring(i),file_short_name:u(l),file_last_modified:e.lastModified}},m=function(e){return Math.round(100*e)/100},u=function(e){return e.length>10?e.substring(0,10)+"...":e},v=function(e,i){for(var t=0;t<multiple_files[i].length;t++){var l=f(multiple_files[i][t].file);if(e.file_name===l.file_name&&e.file_size===l.file_size&&e.file_last_modified===l.file_last_modified)return!0}return!1},p=function(i,t){var l=e("#"+i+"_preview_message"),a=f(single_files[i].file),n=c(i,t,a);n.valid?l.html(""):l.html(n.error_msg),r=n.valid},d=function(i,t){for(var l=e("#"+i+"_preview_message"),a={valid:!0,error_msg:""},n=0;n<multiple_files[i].length;n++){var s=f(multiple_files[i][n].file),_=c(i,t,s);a.valid=_.valid,a.error_msg=_.error_msg}multiple_files[i].length>t.validation[i].file_count&&(a.valid=!1,a.error_msg+="<{tag}>{msg}</{tag}>".pyFormat({tag:t.message_element_item,msg:t.validation_message.file_count.pyFormat({file_count:t.validation[i].file_count})})),a.valid?l.html(""):l.html(a.error_msg),r=a.valid},c=function(i,t,l){var a="",n=!0;return l.file_size>t.validation[i].file_size&&(n=!1,a+="<{tag}>{msg}</{tag}>".pyFormat({tag:t.message_element_item,msg:t.validation_message.file_size.pyFormat({file_size:t.validation[i].file_size})})),0!==t.validation[i].file_type.length&&e.inArray(l.file_extension,t.validation[i].file_type)<0&&(n=!1,a+="<{tag}>{msg}</{tag}>".pyFormat({tag:t.message_element_item,msg:t.validation_message.file_type.pyFormat({file_type:JSON.stringify(t.validation[i].file_type)})})),{valid:n,error_msg:a}},g=function(i,t){i.target.value=null,i.target.files=null,e("#"+t).val("")},{handleSingleFileUpload:function(i,t){var l=i.attr("name"),a=e("#"+i.attr("id")+"_preview");single_files[l]=null,i.change(function(e){a.html("");var i=e.target.files[0];i&&a.html(_(i,l,t)),single_files[l]={file:i},t.enable_validation&&p(l,t),g(e,l)})},handleMultipleFileUpload:function(i,t){var l=i.attr("name").substring(0,i.attr("name").length-2),a=e("#"+i.attr("id")+"_preview"),n=0;multiple_files[l]=[],i.change(function(e){for(var i=0;i<e.target.files.length;i++){n++;var r=e.target.files[i],s=l+"_"+n;r&&a.append(o(r,l,s,t)),multiple_files[l].push({id:s,file:r})}t.enable_validation&&d(l,t),g(e,l)})},createPreviewElement:function(i,t){var l=e("<{tag}></{tag}>".pyFormat({tag:t.preview_element}));l.attr("id",i.attr("id")+"_preview"),l.attr("class","j_preview_container"),i.after(l),t.enable_validation&&s(l,t)},removeSingleFile:function(){e(t).on("click",".j_remove",function(i){i.preventDefault();var t=e(this).attr("target");e(a.pyFormat({input_name:t})).html(""),e("#"+t+"_preview_message").html(""),single_files[t]=null})},removeMultipleFile:function(i){e(t).on("click",".j_remove_multiple",function(t){t.preventDefault();var l=e(this).attr("target"),n=e(this).attr("file_id");for(var r in e(a.pyFormat({id:l})).children("#"+n).remove(),multiple_files)for(var s=0;s<multiple_files[r].length;s++)multiple_files[r][s].id===n&&multiple_files[r].splice(s,1);d(l,i)})},pyFormat:function(i){var t=this;return e.each(i,function(e,i){var l=new RegExp("{"+e+"}","gm");t=t.replace(l,i)}),t},j_isValid:function(){return r}}),y=function(t,l){var a=function(i){i.each(function(){var i=e(this).attr("name").replace(/\[|]/gm,"");w.validation[i]=e.extend(!0,{},F)})},n=function(i){void 0!==i&&void 0!==i.validation&&e.each(w.validation,function(t,l){w.validation[t]=e.extend(w.validation[t],i.validation[t])})},r=function(i,t,l){i.each(function(i,a){void 0!==e(this).attr("multiple")?l.push(e(this)):t.push(e(this))})},s=function(i,t){e.each(i,function(i,a){l.createPreviewElement(e(this),t),l.handleSingleFileUpload(e(this),t)})},_=function(i,t){e.each(i,function(i,a){l.createPreviewElement(e(this),t),l.handleMultipleFileUpload(e(this),t)})};return i.j_prepareFormData=function(e){var i=new FormData(e);for(var t in single_files)i.append(t,null==single_files[t]?null:single_files[t].file);for(var t in multiple_files)for(var l=0;l<multiple_files[t].length;l++)i.append(t+"[]",multiple_files[t][l].file);return i},i.j_isValid=function(){return l.j_isValid()},{init:function(o){String.prototype.pyFormat=l.pyFormat,i.multiple_files=[],i.single_files=[];var f=t.find("input:file"),m=[],u=[];a(f),n(o),o=e.extend(!0,w,o),r(f,m,u),s(m,o),_(u,o),l.removeSingleFile(),l.removeMultipleFile(o)}}}(e(this),h),F={file_size:2,file_type:[".csv",".pdf",".txt",".doc",".rar",".sql"],file_count:5},w={message_element:"div",message_element_item:"span",preview_element:"div",preview_element_item:"span",remove_link_style:"j_remove_link",remove_link_label:"X",enable_validation:!1,validation:{},validation_message:{file_size:"File size must be lower than {file_size} MB",file_type:"File type must be {file_type}",file_count:"Number of files must not exceed {file_count} files"}};if(jQuery().jquery<"3.4.1")throw Error("Wrong jQuery version, update to version 3.4.1");if(void 0!==l&&"object"!=typeof l)throw Error("Wrong parameter, to initialize pass an Object");y.init(l)})}}(jQuery,window,document);